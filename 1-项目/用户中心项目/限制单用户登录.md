---
created: 2024-06-18
updated: 2024-06-18
Type: knowledge
Status: ⌛️ 等待
tags:
---
## 需求

一个账号能多个人同时登录，这个不符合我们的预期，需要加上一点改动，限制单用户登录

## 核心实现思路

登录流程![image.png](https://obsidian-pic-1317906728.cos.ap-nanjing.myqcloud.com/obsidian/20240618010243.png)

就上述的登录逻辑而言，我们没有采取任何措施去限制同一账号只能在单个设备登录，理论上一个账号就可以被任意个用户同时共享使用。
这可能会导致资源访问冲突、权限管理不便、数据隐私泄露、影响系统所有者收入等等一系列严重的问题。
那如何实现账号的单设备登录限制呢? 
>一种很简单的逻辑是，最后登录的人会把前一个登录的人“顶掉”。用计算机术语来解释，就是：
>在登录时，**删除掉该账号在其他设备上的登录态**。目前登录态是保存在后端的 Session 存储里的，而 Session 跟客户端的 Cookie 绑定，所以需要解决的问题就是：
>	如何在当前客户端的登录请求中，**获取并删除该账号在其他客户端上对应 Session 中的登录态**。观察保存在 Redis 中的数据，我们发现 Spring Session 的 key 前缀都是一致的，不同的是后面的字符串（称为 UUID），那这们可以基本判定这个 UUID 跟客户端是有对应关系的。只需要在用户登录的时候，把用户的 userld 作为 key、sessionld 作为 value 保存在 Redis 中。之后如果有其他客户端登录相同账号，就可以根据 userld 找到 sessionld，再获取到 Redis 中的 Spring Session 进行删除了。